----ANALÍTICO DE TELEFONES
IF OBJECT_ID('tempdb..##TMP_BID_HIG_TEL') IS NOT NULL
	DROP TABLE ##TMP_BID_HIG_TEL

IF OBJECT_ID('tempdb..#TMP_LACO') IS NOT NULL
	DROP TABLE #TMP_LACO

SELECT ROW_NUMBER() OVER (ORDER BY COD_CRED ASC) AS COD_LINE,COD_CRED
INTO #TMP_LACO
FROM V_CREDORES

DECLARE @COUNT INT SET @COUNT = 1

WHILE (@COUNT <= (SELECT COUNT(*) FROM 	#TMP_LACO)) BEGIN
	IF (@COUNT = 1) BEGIN
		SELECT DISTINCT
			T.COD_CRED
			,PT.COD_FONE
			,PT.DDD_TEL
			,PT.NR_TEL
			,PT.STATUS_TEL
			,PT.TIPO_TEL
			,PT.DATA_UP
		INTO ##TMP_BID_HIG_TEL
		FROM TITULOS T WITH(NOLOCK)
		INNER JOIN _SOMA_PARC SP WITH(NOLOCK) ON SP.COD_TIT = T.COD_TIT AND T.COD_CRED = (SELECT COD_CRED FROM #TMP_LACO TMP WHERE TMP.COD_LINE = @COUNT)
		INNER JOIN V_DEVEDORES VD WITH(NOLOCK) ON VD.COD_DEV = T.COD_DEV
		INNER JOIN PESSOAS_TELEFONES PT WITH(NOLOCK) ON PT.COD_PES = VD.COD_PES
	END
	ELSE BEGIN
		INSERT INTO ##TMP_BID_HIG_TEL
		SELECT DISTINCT
			T.COD_CRED
			,PT.COD_FONE
			,PT.DDD_TEL
			,PT.NR_TEL
			,PT.STATUS_TEL
			,PT.TIPO_TEL
			,PT.DATA_UP
		FROM TITULOS T WITH(NOLOCK)
		INNER JOIN _SOMA_PARC SP WITH(NOLOCK) ON SP.COD_TIT = T.COD_TIT AND T.COD_CRED = (SELECT COD_CRED FROM #TMP_LACO TMP WHERE TMP.COD_LINE = @COUNT)
		INNER JOIN V_DEVEDORES VD WITH(NOLOCK) ON VD.COD_DEV = T.COD_DEV
		INNER JOIN PESSOAS_TELEFONES PT WITH(NOLOCK) ON PT.COD_PES = VD.COD_PES
	END

	SET @COUNT += 1
END


SELECT
	FORMAT(GETDATE(),'dd/MM/yyyy','pt-br') AS DATA_REF_DADOS
	,@@SERVERNAME AS SERVIDOR
	,DB_NAME() AS BASE
	,(CASE
		WHEN TMP.STATUS_TEL NOT IN (2, 3, 7, 9, 12) AND TMP.DDD_TEL NOT IN ('11','12','13','14','15','16','17','18','19','21','22','24','27','28','31','32','33','34','35','37',
		 '38','41','42','43','44','45','46','47','48','49','51','53','54','55','61','62','63','64','65','66','67','68','69','71','73','74','75','77',
		'79','81','82','83','84','85','86','87','88','89','91','92','93','94','95','96','97','98','99') THEN 'DDD INEXISTENTE'
		WHEN TMP.STATUS_TEL NOT IN (2, 3, 7, 9, 12) AND (ISNUMERIC(TMP.DDD_TEL) = 0) THEN 'DDD NÃO É NUMÉRICO'
		WHEN TMP.STATUS_TEL NOT IN (2, 3, 7, 9, 12) AND (ISNUMERIC(TMP.NR_TEL) = 0) THEN 'TELEFONE NÃO É NÚMERICO'
		WHEN TMP.STATUS_TEL NOT IN (2, 3, 7, 9, 12) AND LEN(TMP.NR_TEL) < 8 THEN 'TELEFONE < 8 DÍGITOS'
		WHEN TMP.STATUS_TEL NOT IN (2, 3, 7, 9, 12) AND LEN(TMP.NR_TEL) > 9 THEN 'TELEFONE > 9 DÍGITOS'
		WHEN TMP.STATUS_TEL NOT IN (2, 3, 7, 9, 12) AND TMP.NR_TEL IN (
		'00000000','11111111','22222222','33333333','44444444','55555555','66666666','77777777','88888888','99999999','000000000'
		,'111111111','222222222','333333333','444444444','555555555','666666666','777777777','888888888','999999999','900000000'
		,'911111111','922222222','933333333','944444444','955555555','966666666','977777777','988888888') THEN 'TELEFONE COM TODOS DIGITOS IGUAIS'
		ELSE 'OK'
	END) AS DESCRICAO
	,COUNT(DISTINCT TMP.COD_FONE) AS QTD_FONES
FROM ##TMP_BID_HIG_TEL TMP WITH(NOLOCK)
GROUP BY
	(CASE
		WHEN TMP.STATUS_TEL NOT IN (2, 3, 7, 9, 12) AND TMP.DDD_TEL NOT IN ('11','12','13','14','15','16','17','18','19','21','22','24','27','28','31','32','33','34','35','37',
		 '38','41','42','43','44','45','46','47','48','49','51','53','54','55','61','62','63','64','65','66','67','68','69','71','73','74','75','77',
		'79','81','82','83','84','85','86','87','88','89','91','92','93','94','95','96','97','98','99') THEN 'DDD INEXISTENTE'
		WHEN TMP.STATUS_TEL NOT IN (2, 3, 7, 9, 12) AND (ISNUMERIC(TMP.DDD_TEL) = 0) THEN 'DDD NÃO É NUMÉRICO'
		WHEN TMP.STATUS_TEL NOT IN (2, 3, 7, 9, 12) AND (ISNUMERIC(TMP.NR_TEL) = 0) THEN 'TELEFONE NÃO É NÚMERICO'
		WHEN TMP.STATUS_TEL NOT IN (2, 3, 7, 9, 12) AND LEN(TMP.NR_TEL) < 8 THEN 'TELEFONE < 8 DÍGITOS'
		WHEN TMP.STATUS_TEL NOT IN (2, 3, 7, 9, 12) AND LEN(TMP.NR_TEL) > 9 THEN 'TELEFONE > 9 DÍGITOS'
		WHEN TMP.STATUS_TEL NOT IN (2, 3, 7, 9, 12) AND TMP.NR_TEL IN (
		'00000000','11111111','22222222','33333333','44444444','55555555','66666666','77777777','88888888','99999999','000000000'
		,'111111111','222222222','333333333','444444444','555555555','666666666','777777777','888888888','999999999','900000000'
		,'911111111','922222222','933333333','944444444','955555555','966666666','977777777','988888888') THEN 'TELEFONE COM TODOS DIGITOS IGUAIS'
		ELSE 'OK'
	END)